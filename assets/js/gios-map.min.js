$(document).ready(function(){function e(){$(".gios-research-map").trigger("zoom",{level:0,longitude:0,latitude:0})}function t(){o.zoom.detailMode=!1,o.dimensions.scaleUp=!0,$(".country-name").html(o.title.default),$(".overlay").fadeOut("slow"),$(".gios-research-map").trigger("update",[{newPlots:o.data.originalBubbles,animDuration:250}]),function(){var e={areas:{}};o.data.highlightedAreas.forEach(function(t,a){e.areas[t]={attrs:{fill:o.colors.countries},attrsHover:{fill:o.colors.countries},text:{content:""}}}),$(".gios-research-map").trigger("update",[{mapOptions:e,animDuration:250}])}(),$("#details").fadeOut("slow").empty(),e()}var o={truncation:{minimumRequired:3,showChar:150,ellipsestext:"...",moretext:"[More]",lesstext:"[Less]"},colors:{countries:"#EFF2EE",countryHover:"#EFF2EE",selectedCountryFill:"#0080FF",borders:"#000",bubbleFill:"#0080FF",bubbleBorder:"#7F8E96",bubbleHoverFill:"",bubbleHoverBorder:"#0080FF",textFill:"#FFF",textBorder:"#000"},zoom:{detailMode:!1},dimensions:{initialHeight:0,smallHeight:0,scaleUp:!1},data:{originalBubbles:{},highlightedAreas:[]},images:{sdgPath:"sdg-",sdgFormat:".png"},title:{default:"GIOS Research Map"}};$(".map-container").mapael({map:{zoom:{enabled:!0,touch:!0,maxLevel:30,animDuration:500},name:"world_countries_miller",cssClass:"gios-research-map",defaultArea:{attrs:{stroke:o.colors.borders,fill:o.colors.countries,"stroke-width":.1},text:{content:"",attrs:{fill:o.colors.textFill,stroke:o.colors.textBorder,"stroke-width":1,"font-size":32},position:"right"},attrsHover:{fill:o.colors.countries}},defaultPlot:{size:15,attrs:{fill:o.colors.bubbleFill,"fill-opacity":.5,"stroke-width":0},attrsHover:{fill:o.colors.bubbleHover,transform:"s1.25",animDuration:100,"stroke-width":2,stroke:o.colors.bubbleHoverBorder,"fill-opacity":.85},eventHandlers:{click:function(e,t,a,s,i){!function(e){var t=e.iso;o.zoom.detailMode=!0;var a=e.latitude,s=e.longitude,i=15;o.data.highlightedAreas.push(t),updatedOptions={areas:{}},updatedOptions.areas[t]={attrs:{fill:o.colors.selectedCountryFill},attrsHover:{fill:o.colors.selectedCountryFill}},$(".gios-research-map").trigger("update",[{mapOptions:updatedOptions,deletePlotKeys:"all",animDuration:100,afterUpdate:function(){}}]),$(".tool-tip").fadeOut(),void 0!==e.zoom&&e.zoom>0&&(i=e.zoom),$(".gios-research-map").trigger("zoom",{level:i,longitude:s,latitude:a});var l=$("#template").html(),r=e.projects;$.each(r,function(e,t){t.sdg=wpUrls.img_path+"/"+o.images.sdgPath+t.sdg+o.images.sdgFormat});var n={country:e.name,items:e.projects};Mustache.parse(l);var c=Mustache.render(l,n);$("#details").html(c),$(".more").length>=o.truncation.minimumRequired&&$(".more").each(function(){var e=$(this).html();if(e.length>o.truncation.showChar){var t=e.substr(0,o.truncation.showChar),a=e.substr(o.truncation.showChar,e.length-o.truncation.showChar),s=t+'<span class="moreellipses">'+o.truncation.ellipsestext+'&nbsp;</span><span class="morecontent"><span>'+a+'</span>&nbsp;&nbsp;<a href="#" class="morelink">'+o.truncation.moretext+"</a></span>";$(this).html(s)}}),$(".country-name").html(e.name),$("#details").show()}(i)}}},tooltip:{cssClass:"tool-tip",offset:{left:0,top:0}},afterInit:function(){projectList=$.getJSON("https://researchmap.api.gios.asu.edu/v1/locations").done(function(e){$.each(e,function(e,t){t.tooltip={content:t.name}}),o.data.originalBubbles=e,function(e){$(".gios-research-map").trigger("update",[{newPlots:e,animDuration:500}])}(o.data.originalBubbles),$(".country-name").html(o.title.default)})}}}),$(".gios-research-map").on("afterZoom",function(){o.zoom.detailMode?(o.dimensions.initialHeight=$(".gios-research-map > svg").height(),o.dimensions.smallHeight=Math.floor(.4*o.dimensions.initialHeight),$("#research-map, #research-map > svg").animate({height:o.dimensions.smallHeight+"px"},500,function(){$(".overlay").fadeIn("slow",function(){$('[class*="map-zoom"]').addClass("map-control-disabled"),$(".details-close").removeClass("map-control-disabled")})})):o.dimensions.scaleUp&&(o.dimensions.scaleUp=!1,$(".gios-research-map, .gios-research-map > svg").animate({height:o.dimensions.initialHeight+"px"},500,function(){$(".overlay").fadeOut("slow",function(){$('[class*="map-zoom"]').removeClass("map-control-disabled")})}))}),$(".map-zoom-in:not(map-control-disabled)").click(function(){$(".gios-research-map").trigger("zoom",{level:"+5"})}),$(".map-zoom-out:not(map-control-disabled)").click(function(){$(".gios-research-map").trigger("zoom",{level:"-5"})}),$(".map-zoom-reset:not(map-control-disabled)").click(function(){e()}),$(".details-close:not(map-control-disabled)").click(function(){$(".details-close").addClass("map-control-disabled"),t()}),$("#details").on("click",".morelink",function(){return $(this).hasClass("less")?($(this).removeClass("less"),$(this).html(o.truncation.moretext)):($(this).addClass("less"),$(this).html(o.truncation.lesstext)),$(this).parent().prev().toggle(),$(this).prev().toggle(),!1})});