$(document).ready(function(){function t(){$(".gios-research-map, .gios-research-map > svg").animate({height:o.dimensions.initialHeight+"px"},0,function(){$(".overlay").fadeOut("slow",function(){$('[class*="map-zoom"]').fadeIn("fast"),$(".gios-research-map > svg ").animate({opacity:1},250,void $("#details").fadeOut(250))})})}function e(){o.zoom.detailMode=!1,o.dimensions.scaleUp=!0,$(document).off("keyup"),$("#country-name").html(o.title.default),$("#details-close").addClass("map-control-disabled"),$("#map-zoom-in, #map-zoom-out").removeClass("map-control-disabled"),$(".overlay").fadeOut("fast"),$(".gios-research-map").trigger("update",[{newPlots:o.data.originalBubbles,animDuration:250}]),function(){var t={areas:{}};o.data.highlightedAreas.forEach(function(e,a){t.areas[e]={attrs:{fill:o.colors.countries},attrsHover:{fill:o.colors.countries},text:{content:""}}}),$(".gios-research-map").trigger("update",[{mapOptions:t,animDuration:250}])}(),$(".gios-research-map > svg ").css("opacity",0),$(".gios-research-map").trigger("zoom",{level:0,longitude:0,latitude:0,animDuration:0})}var o={truncation:{minimumRequired:3,showChar:150,ellipsestext:"...",moretext:"[More]",lesstext:"[Less]"},colors:{countries:"#7c7c7c",countryHover:"#7c7c7c",selectedCountryFill:"#FFB204",borders:"#000",bubbleFill:"#FFB204",bubbleBorder:"#FFB204",bubbleHoverFill:"",bubbleHoverBorder:"#FFB204",textFill:"#FFF",textBorder:"#000"},zoom:{detailMode:!1},dimensions:{initialHeight:0,smallHeight:0,scaleUp:!1},data:{originalBubbles:{},highlightedAreas:[],url:$("#gios-map-container").data().dataUrl},images:{sdgPath:"sdg-",sdgFormat:".png"},title:{default:$("#country-name").text()}};$(".map-container").mapael({map:{zoom:{enabled:!0,touch:!0,maxLevel:30,animDuration:250},name:"world_countries_miller",cssClass:"gios-research-map",defaultArea:{attrs:{stroke:o.colors.borders,fill:o.colors.countries,"stroke-width":.1},text:{content:"",attrs:{fill:o.colors.textFill,stroke:o.colors.textBorder,"stroke-width":1,"font-size":32},position:"right"},attrsHover:{fill:o.colors.countryHover}},defaultPlot:{size:15,attrs:{fill:o.colors.bubbleFill,"fill-opacity":.75,"stroke-width":0},attrsHover:{fill:o.colors.bubbleHover,transform:"s1.25",animDuration:100,"stroke-width":2,stroke:o.colors.bubbleHoverBorder,"fill-opacity":.85},eventHandlers:{click:function(t,e,a,s,i){!function(t){var e=0,a=0;$('[class*="map-zoom"]').fadeOut("fast"),$("#map-zoom-in, #map-zoom-out").addClass("map-control-disabled");var s=t.iso;o.zoom.detailMode=!0,"XX"!==s&&(e=t.latitude,a=t.longitude);var i=15;o.data.highlightedAreas.push(s),updatedOptions={areas:{}},updatedOptions.areas[s]={attrs:{fill:o.colors.selectedCountryFill},attrsHover:{fill:o.colors.selectedCountryFill}},$(".gios-research-map").trigger("update",[{mapOptions:updatedOptions,deletePlotKeys:"all",animDuration:500,afterUpdate:function(){}}]),$(".tool-tip").fadeOut(),void 0!==t.zoom&&(i=t.zoom,console.log("Just received a zoom level of: "+i)),$(".gios-research-map").trigger("zoom",{level:i,longitude:a,latitude:e});var r=$("#template").html(),l=t.projects;$.each(l,function(t,e){e.sdg?e.iconPath=wpUrls.img_path+"/"+o.images.sdgPath+e.sdg+o.images.sdgFormat:e.iconPath=null});var n={country:t.name,items:t.projects};Mustache.parse(r);var c=Mustache.render(r,n);$("#details").html(c),$(".more").length>=o.truncation.minimumRequired&&$(".more").each(function(){var t=$(this).html();if(t.length>o.truncation.showChar){var e=t.substr(0,o.truncation.showChar),a=t.substr(o.truncation.showChar,t.length-o.truncation.showChar),s=e+'<span class="moreellipses">'+o.truncation.ellipsestext+'&nbsp;</span><span class="morecontent"><span>'+a+'</span>&nbsp;&nbsp;<a href="#" class="morelink">'+o.truncation.moretext+"</a></span>";$(this).html(s)}}),$("#country-name").html(t.name),$("#details").fadeIn("slow")}(i)}}},tooltip:{cssClass:"tool-tip",offset:{left:0,top:0}},afterInit:function(){var t=0;projectList=$.getJSON(o.data.url).done(function(e){$.each(e,function(e,o){o.tooltip={content:o.name},"XX"==o.iso&&0==t&&(o.type="image",o.url=wpUrls.img_path+"/global.png",o.width=32,o.height=32,t=1)}),o.data.originalBubbles=e,function(t){$(".gios-research-map").trigger("update",[{newPlots:t,animDuration:500}])}(o.data.originalBubbles)})}}}),$(".gios-research-map").on("afterZoom",function(){o.zoom.detailMode?(o.dimensions.initialHeight=$(".gios-research-map > svg").height(),o.dimensions.smallHeight=Math.floor(.4*o.dimensions.initialHeight),$("#research-map, #research-map > svg").animate({height:o.dimensions.smallHeight+"px"},500,function(){$(".overlay").fadeIn(250,function(){$("#details-close").removeClass("map-control-disabled"),$(document).on("keyup",function(t){e(),t.stopPropagation()})})})):o.dimensions.scaleUp&&(o.dimensions.scaleUp=!1,t())}),$("#map-zoom-in").click(function(){$(this).hasClass("map-control-disabled")||$(".gios-research-map").trigger("zoom",{level:"+5"})}),$("#map-zoom-out").click(function(){$(this).hasClass("map-control-disabled")||$(".gios-research-map").trigger("zoom",{level:"-5"})}),$("#details-close").click(function(){$(this).hasClass("map-control-disabled")||e()}),$("#details").on("click",".morelink",function(){return $(this).hasClass("less")?($(this).removeClass("less"),$(this).html(o.truncation.moretext)):($(this).addClass("less"),$(this).html(o.truncation.lesstext)),$(this).parent().prev().toggle(),$(this).prev().toggle(),!1})});